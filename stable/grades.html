<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>grade.calc</title>

  <!-- Your main site variables + base look -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="gradecalc.css" />
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

  <style>
    /* Match main site background layers */
    #dither-background-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -2; pointer-events: none;
    }
    #scanline-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- main-site background -->
  <canvas id="dither-background-canvas"></canvas>
  <div id="scanline-overlay"></div>

  <div class="gc-page">
    <header class="gc-top gc-window">
      <div class="gc-top-left">
        <div class="gc-title">grade.calc</div>
        <div class="gc-sub">subjects • targets • stats</div>
      </div>
      <div class="gc-top-actions">
        <button class="gc-btn" id="btnDashboard">dashboard</button>
        <button class="gc-btn" id="btnStats">stats</button>
        <button class="gc-btn gc-btn-primary" id="btnAddSubject">+ subject</button>
        <button class="gc-btn" id="btnSettings">settings</button>
        <button class="gc-btn" id="btnExport">export</button>
        <button class="gc-btn" id="btnImport">import</button>
        <button class="gc-btn gc-btn-danger" id="btnReset">reset</button>
      </div>
    </header>

    <div class="gc-grid">
      <aside class="gc-window gc-side">
        <div class="gc-side-head">
          <div class="gc-h">subjects</div>
          <div class="gc-mini" id="subjectCount">0</div>
        </div>

        <div class="gc-side-search">
          <div class="gc-mini">search</div>
          <input class="gc-input" id="search" placeholder="search subjects…" />
        </div>

        <div class="gc-subjects" id="subjectList"></div>
      </aside>

      <main class="gc-window gc-main" id="main"></main>
    </div>
  </div>

  <!-- Add Subject -->
  <dialog id="dlgSubject" class="gc-dialog">
    <div class="gc-dialog-head">
      <div class="gc-dialog-title">add subject</div>
      <button class="gc-btn" data-close>×</button>
    </div>
    <div class="gc-dialog-body">
      <label class="gc-mini">name</label>
      <input class="gc-input" id="subName" placeholder="e.g., matematinė analizė I" />

      <div class="gc-cols" style="margin-top:10px">
        <div>
          <label class="gc-mini">semester (1–8)</label>
          <select class="gc-input" id="subSemNo">
            <option value="">—</option>
            <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option>
          </select>
        </div>
        <div>
          <label class="gc-mini">credits</label>
          <input class="gc-input" id="subCredits" type="number" step="0.5" placeholder="e.g., 6" />
          <div class="gc-mini" style="margin-top:6px">used for overall / semester averages</div>
        </div>
        <div>
          <label class="gc-mini">year (optional)</label>
          <input class="gc-input" id="subYear" type="number" step="1" placeholder="e.g., 2026" />
        </div>
      </div>

      <div class="gc-cols" style="margin-top:10px">
        <div>
          <label class="gc-mini">season (optional)</label>
          <select class="gc-input" id="subSeason">
            <option value="">—</option>
            <option value="Fall">Fall</option>
            <option value="Spring">Spring</option>
          </select>
        </div>
        <div style="grid-column: span 2;">
          <label class="gc-mini">term label (optional)</label>
          <input class="gc-input" id="subTerm" placeholder="e.g., 2026 Fall (VU)" />
        </div>
      </div>

      <div class="gc-mini" style="margin-top:10px">
        you can add professor, type (IND/PD/Programinis), and a single info link inside the subject page.
      </div>
    </div>
    <div class="gc-dialog-foot">
      <button class="gc-btn" data-close>cancel</button>
      <button class="gc-btn gc-btn-primary" id="createSubject">create</button>
    </div>
  </dialog>

  <!-- Add Component -->
  <dialog id="dlgComponent" class="gc-dialog">
    <div class="gc-dialog-head">
      <div class="gc-dialog-title">add component</div>
      <button class="gc-btn" data-close>×</button>
    </div>
    <div class="gc-dialog-body">
      <label class="gc-mini">name</label>
      <input class="gc-input" id="cmpName" placeholder="e.g., midterm" />
      <div class="gc-cols" style="margin-top:10px">
        <div>
          <label class="gc-mini">weight %</label>
          <input class="gc-input" id="cmpWeight" type="number" step="0.01" placeholder="e.g., 30" />
        </div>
        <div>
          <label class="gc-mini">expected % (optional)</label>
          <input class="gc-input" id="cmpExpected" type="number" step="0.01" placeholder="e.g., 80" />
        </div>
        <div>
          <label class="gc-mini">—</label>
          <div class="gc-mini">bonus points are configured in the subject’s bonus panel.</div>
        </div>
      </div>
    </div>
    <div class="gc-dialog-foot">
      <button class="gc-btn" data-close>cancel</button>
      <button class="gc-btn gc-btn-primary" id="createComponent">add</button>
    </div>
  </dialog>
<!-- Settings -->
  <dialog id="dlgSettings" class="gc-dialog">
    <div class="gc-dialog-head">
      <div class="gc-dialog-title">settings</div>
      <button class="gc-btn" data-close>×</button>
    </div>
    <div class="gc-dialog-body">
      <div class="gc-cols">
        <div>
          <label class="gc-mini">display</label>
          <select class="gc-input" id="setScale">
            <option value="percent">percent (0–100)</option>
            <option value="ten">mark out of 10</option>
            <option value="letter">letters (A–F)</option>
          </select>
        </div>
        <div>
          <label class="gc-mini">rounding (decimals)</label>
          <input class="gc-input" id="setRound" type="number" min="0" max="4" step="1" />
        </div>
        <div>
          <label class="gc-mini">10-scale max</label>
          <input class="gc-input" id="setTenMax" type="number" step="0.1" />
        </div>
      </div>

      <div class="gc-cols" style="margin-top:10px">
        <div>
          <label class="gc-mini">cap displayed percent at 100%</label>
          <select class="gc-input" id="setCap100">
            <option value="no">no (allow &gt; 100%)</option>
            <option value="yes">yes (cap at 100)</option>
          </select>
        </div>
        <div>
          <label class="gc-mini">bonuses</label>
          <select class="gc-input" id="setBonusEnabled">
            <option value="yes">enabled</option>
            <option value="no">disabled (ignore all bonus values)</option>
          </select>
        </div>
        <div>
          <label class="gc-mini">—</label>
          <div class="gc-mini">turn off if your uni doesn’t allow extra credit.</div>
        </div>
      </div>
    </div>
    <div class="gc-dialog-foot">
      <button class="gc-btn" data-close>cancel</button>
      <button class="gc-btn gc-btn-primary" id="saveSettings">save</button>
    </div>
  </dialog>

  <!-- Import -->
  <dialog id="dlgImport" class="gc-dialog">
    <div class="gc-dialog-head">
      <div class="gc-dialog-title">import json</div>
      <button class="gc-btn" data-close>×</button>
    </div>
    <div class="gc-dialog-body">
      <label class="gc-mini">paste export (replaces local data)</label>
      <textarea class="gc-input" id="importText" rows="10" style="resize:vertical"></textarea>
    </div>
    <div class="gc-dialog-foot">
      <button class="gc-btn" data-close>cancel</button>
      <button class="gc-btn gc-btn-primary" id="doImport">import</button>
    </div>
  </dialog>

  <!-- Dither script copied from main page (unchanged behavior) -->
  <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.164.1/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/" } }
  </script>

  <script type="module" id="dither-script">
    import * as THREE from 'three';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
    import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';

    const waveVertexShader = `varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`;
    const waveFragmentShader = `
      uniform vec2 resolution;uniform float time;uniform float waveSpeed;uniform float waveFrequency;uniform float waveAmplitude;uniform vec3 waveColor;
      vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}
      vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}
      vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}
      vec2 fade(vec2 t){return t*t*t*(t*(t*6.0-15.0)+10.0);}
      float cnoise(vec2 P){vec4 Pi=floor(P.xyxy)+vec4(0.0,0.0,1.0,1.0);vec4 Pf=fract(P.xyxy)-vec4(0.0,0.0,1.0,1.0);Pi=mod289(Pi);
      vec4 ix=Pi.xzxz;vec4 iy=Pi.yyww;vec4 fx=Pf.xzxz;vec4 fy=Pf.yyww;vec4 i=permute(permute(ix)+iy);vec4 gx=fract(i*(1.0/41.0))*2.0-1.0;
      vec4 gy=abs(gx)-0.5;vec4 tx=floor(gx+0.5);gx=gx-tx;vec2 g00=vec2(gx.x,gy.x);vec2 g10=vec2(gx.y,gy.y);vec2 g01=vec2(gx.z,gy.z);vec2 g11=vec2(gx.w,gy.w);
      vec4 norm=taylorInvSqrt(vec4(dot(g00,g00),dot(g01,g01),dot(g10,g10),dot(g11,g11)));g00*=norm.x;g01*=norm.y;g10*=norm.z;g11*=norm.w;
      float n00=dot(g00,vec2(fx.x,fy.x));float n10=dot(g10,vec2(fx.y,fy.y));float n01=dot(g01,vec2(fx.z,fy.z));float n11=dot(g11,vec2(fx.w,fy.w));
      vec2 fade_xy=fade(Pf.xy);vec2 n_x=mix(vec2(n00,n01),vec2(n10,n11),fade_xy.x);return 2.3*mix(n_x.x,n_x.y,fade_xy.y);}
      const int OCTAVES=4;float fbm(vec2 p){float value=0.0;float amp=1.0;float freq=waveFrequency;for(int i=0;i<OCTAVES;i++){value+=amp*abs(cnoise(p));p*=freq;amp*=waveAmplitude;}return value;}
      float pattern(vec2 p){vec2 p2=p-time*waveSpeed;return fbm(p+fbm(p2));}
      void main(){vec2 uv=gl_FragCoord.xy/resolution.xy;uv-=0.5;uv.x*=resolution.x/resolution.y;float f=pattern(uv);vec3 col=mix(vec3(0.0),waveColor,f);gl_FragColor=vec4(col,1.0);}
    `;

    const DitherShader={
      uniforms:{'tDiffuse':{value:null},'colorNum':{value:4.0},'pixelSize':{value:2.0},'resolution':{value:new THREE.Vector2()}},
      vertexShader:`varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
      fragmentShader:`uniform sampler2D tDiffuse;uniform float colorNum;uniform float pixelSize;uniform vec2 resolution;varying vec2 vUv;
      const float bayerMatrix8x8[64]=float[](0.0,48.0,12.0,60.0,3.0,51.0,15.0,63.0,32.0,16.0,44.0,28.0,35.0,19.0,47.0,31.0,8.0,56.0,4.0,52.0,11.0,59.0,7.0,55.0,40.0,24.0,36.0,20.0,43.0,27.0,39.0,23.0,2.0,50.0,14.0,62.0,1.0,49.0,13.0,61.0,34.0,18.0,46.0,30.0,33.0,17.0,45.0,29.0,10.0,58.0,6.0,54.0,9.0,57.0,5.0,53.0,42.0,26.0,38.0,22.0,41.0,25.0,37.0,21.0);
      vec3 dither(vec2 uv,vec3 color){vec2 scaledCoord=floor(uv*resolution/pixelSize);int x=int(mod(scaledCoord.x,8.0));int y=int(mod(scaledCoord.y,8.0));
      float threshold=(bayerMatrix8x8[y*8+x]/64.0)-0.25;float step=1.0/(colorNum-1.0);color+=threshold*step;float bias=0.2;color=clamp(color-bias,0.0,1.0);
      return floor(color*(colorNum-1.0)+0.5)/(colorNum-1.0);}
      void main(){vec2 normalizedPixelSize=pixelSize/resolution;vec2 uvPixel=normalizedPixelSize*floor(vUv/normalizedPixelSize);
      vec4 color=texture2D(tDiffuse,uvPixel);color.rgb=dither(gl_FragCoord.xy,color.rgb);gl_FragColor=color;}
      `
    };

    let scene,camera,renderer,composer,clock;
    let waveMaterial,ditherPass;

    function init(){
      scene=new THREE.Scene();
      clock=new THREE.Clock();
      camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);
      renderer=new THREE.WebGLRenderer({canvas:document.getElementById('dither-background-canvas'),antialias:true});
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth,window.innerHeight);

      const geometry=new THREE.PlaneGeometry(2,2);
      waveMaterial=new THREE.ShaderMaterial({
        vertexShader:waveVertexShader,
        fragmentShader:waveFragmentShader,
        uniforms:{
          time:{value:0},
          resolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},
          waveSpeed:{value:0.05},
          waveFrequency:{value:3.0},
          waveAmplitude:{value:0.3},
          waveColor:{value:new THREE.Color(0.6,0.1,0.15)},
        }
      });

      const mesh=new THREE.Mesh(geometry,waveMaterial);
      scene.add(mesh);

      composer=new EffectComposer(renderer);
      composer.addPass(new RenderPass(scene,camera));
      ditherPass=new ShaderPass(DitherShader);
      ditherPass.uniforms.colorNum.value=4.0;
      ditherPass.uniforms.pixelSize.value=2.0;
      ditherPass.uniforms.resolution.value.set(window.innerWidth*window.devicePixelRatio,window.innerHeight*window.devicePixelRatio);
      composer.addPass(ditherPass);

      window.addEventListener('resize',onWindowResize);
    }

    function onWindowResize(){
      const width=window.innerWidth, height=window.innerHeight;
      camera.aspect=width/height;
      camera.updateProjectionMatrix();
      renderer.setSize(width,height);
      composer.setSize(width,height);
      const dpr=renderer.getPixelRatio();
      waveMaterial.uniforms.resolution.value.set(width,height);
      ditherPass.uniforms.resolution.value.set(width*dpr,height*dpr);
    }

    function animate(){
      requestAnimationFrame(animate);
      waveMaterial.uniforms.time.value=clock.getElapsedTime();
      composer.render();
    }

    init(); animate();
  </script>

  <script src="gradecalc.js"></script>
</body>
</html>
